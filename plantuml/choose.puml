@startuml SA_choose
title СА: choose
start
:НУ: Инициализировать локальные объекты (например, переменная ПРЕД_ХОД);
note right
    Флаг ОКМ (оппонент знает методику) = False
    ПХС (пред. ход соперника), поступает на каждом ходу;
    ПХ (мой предыдущий ход), инициализирован;
    МПХС (массив ПХС), инициализирован как пустой;
end note
:Если входной ПХС ≠ 0 → добавить ПХС в МПХС;
:Попытаться обнаружить детерминированное правило;

:Установить N = min(3, размер МПХС);
while (N ≥ 1?) is (true)
  :Составить образец из последних N элементов МПХС;
  :Проверить, детерминирован ли образец;
  if (Образец детерминирован?) then (да)
    :ПРЕД_ХОД = значение из образца;
    :Установить Флаг ОКМ = True;
    break
  else (нет)
    :Уменьшить N на 1;
  endif
endwhile

if (ПРЕД_ХОД найден?) then (да)
  :Вызвать "Определить контрход к ПХС" с входом (ПРЕД_ХОД, win);
else
  if (ПХ отсутствует?) then (да)
    :Выбрать базовый ход;
  else
    :Определить исход предыдущего раунда (win/tie или lose);
    :Вызвать "Определить контрход к ПХС" с входом (ПХС, заданный результат);
  endif
endif
:Сохранить выбранный ход как ПХ;
:return выбранный ход;
stop
@enduml



@startuml

start

repeat

  :Тестирование;

    if (Что-то пошло не так?) then (нет)
      #palegreen :Тест пройден;
      break
    endif

    ->ошибка;

    :Сообщение: "Длинное сообщение об ошибке";

repeat while (Что-то пошло не так при\nвыводе сообщения об ошибке?) is (да) not (нет)

:Сообщение: "Всё прошло успешно";

stop

@enduml
